<!DOCTYPE html><html lang="es-MX" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Fundamentos Para Construir Pruebas de Software Eficaces" /><meta property="og:locale" content="es_MX" /><meta name="description" content="En este artículo quiero compartir las lecciones que aprendí construyendo el set de pruebas para el proyecto más reciente en el que trabajé." /><meta property="og:description" content="En este artículo quiero compartir las lecciones que aprendí construyendo el set de pruebas para el proyecto más reciente en el que trabajé." /><link rel="canonical" href="https://luisguerrerolab.com/posts/fundamentos-para-construir-pruebas-de-software-eficaces/" /><meta property="og:url" content="https://luisguerrerolab.com/posts/fundamentos-para-construir-pruebas-de-software-eficaces/" /><meta property="og:site_name" content="Luis Guerrero" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-13T21:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Fundamentos Para Construir Pruebas de Software Eficaces" /><meta name="twitter:site" content="@luisguerrerolab" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"En este artículo quiero compartir las lecciones que aprendí construyendo el set de pruebas para el proyecto más reciente en el que trabajé.","url":"https://luisguerrerolab.com/posts/fundamentos-para-construir-pruebas-de-software-eficaces/","headline":"Fundamentos Para Construir Pruebas de Software Eficaces","@type":"BlogPosting","dateModified":"2020-08-16T21:01:33-05:00","datePublished":"2020-08-13T21:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://luisguerrerolab.com/posts/fundamentos-para-construir-pruebas-de-software-eficaces/"},"@context":"https://schema.org"}</script><title>Fundamentos Para Construir Pruebas de Software Eficaces | Luis Guerrero</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6YMQH26JZ2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-6YMQH26JZ2'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Luis Guerrero</a></div><div class="site-subtitle font-italic">Finanzas personales.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/luisguerrerolab" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/luisguerrerolab" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Fundamentos Para Construir Pruebas de Software Eficaces</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Fundamentos Para Construir Pruebas de Software Eficaces</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Luis Guerrero </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 13, 2020, 9:00 PM -0500" prep="on" > Aug 13, 2020 <i class="unloaded">2020-08-13T21:00:00-05:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 16, 2020, 9:01 PM -0500" prefix="Updated " > Aug 16, 2020 <i class="unloaded">2020-08-16T21:01:33-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1597 words">8 min</span></div></div><div class="post-content"><p>En este artículo quiero compartir las lecciones que aprendí construyendo el set de pruebas para el proyecto más reciente en el que trabajé.</p><h2 id="escribir-pruebas-es-una-habilidad">Escribir pruebas es una habilidad</h2><p>A diferencia del código que forma parte de una aplicación dirigida a un usuario final, las pruebas que validan su comportamiento sólo son conocidas por el equipo de ingenieros que las crearon. <strong>Es código que siempre vive detrás del escenario</strong>. Su trabajo es asegurarse de que los actores principales (los módulos) den un espectáculo de primera en cada entrega.</p><p><strong>Ese aparente papel secundario de las pruebas puede provocar que relajemos los criterios de calidad en su construcción</strong>, en contraste con la fuerte devoción con que seguimos las buenas prácticas de programación para construir la propia aplicación.</p><p>Además, durante situaciones de estrés, como bomberazos o cuando descubrimos un error crítico, ajustar las pruebas existentes o crear nuevas pueden parecer tareas fastidiosas que se interponen entre el desarrollador y el código liberado en producción.</p><p>Pero así como aprendimos a programar, <strong>escribir pruebas también es una habilidad que podemos cultivar y mejorar cuanto más la practiquemos</strong>.</p><h2 id="las-pruebas-son-un-lienzo-de-práctica">Las pruebas son un lienzo de práctica</h2><p>Las primeras pruebas para una aplicación suelen construirse usando el <em>patrón Copy/Paste</em>. Y eso está bien. La primera misión de una prueba es verificar que el sistema funciona. El refinamiento viene después, cuando el volumen de pruebas comienza a ser considerable. Pero según avanza el desarrollo, evitar código duplicado a veces no es tan simple como centralizar en una función todos los bloques de código repetidos por toda la aplicación.</p><p>Cuando la arquitectura del proyecto alcanza un cierto nivel de complejidad, debemos considerar estrategias de diseño software más sofisticadas. Por ejemplo: el Principio de Inversión de Dependencias es súper útil en las pruebas, para ayudarnos a acceder a versiones <em>ligeras</em> de una implementación compleja que vive en producción.</p><p>En ese sentido, <strong>cada prueba es un lienzo donde podemos practicar nuestro oficio</strong>.</p><p>Cada prueba es una oportunidad para simplificar la lógica de nuestra aplicación y reducir el código. Menos líneas, menos problemas para resolver.</p><p>Desde mi punto de vista, los dos principios más importantes que pueden servir como guía para cualquier proyecto de pruebas son DRY y SRP.</p><h2 id="principio-dry">Principio DRY</h2><p>Don’t Repeat Yourself. No te repitas.</p><h3 id="pasar-valores-como-variables">Pasar valores como variables</h3><p>Pasar valores como cadenas directamente a funciones puede causar confusión al lector de las pruebas. Si una cadena parece fuera de lo ordinario, el lector se cuestionará por qué se eligió cierto valor para un parámetro o valor de retorno. Un mejor acercamiento es asignar esos valores a una variable que haga explícito su significado.</p><p>Evita valores mágicos.</p><p>Podría mejorar:</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ItemRequest</span>
<span class="p">{</span>
    <span class="n">Id</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">(),</span>
    <span class="n">Name</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">(</span><span class="sc">'a'</span><span class="p">,</span> <span class="m">251</span><span class="p">),</span> <span class="c1">// ¡Ah, caray¡ ¿Por qué, 251? ¿Por qué? ¡Me esstoy perdiendo algo!</span>
    <span class="n">Description</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">(</span><span class="sc">'b'</span><span class="p">,</span> <span class="m">251</span><span class="p">),</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Mejor:</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">lengthGreaterThanAllowed</span> <span class="p">=</span> <span class="m">251</span><span class="p">;</span> <span class="c1">// Ahora queda claro a simple vista qué representa ese 251.</span>
<span class="kt">var</span> <span class="n">request</span> <span class="k">new</span> <span class="n">ItemRequest</span>
<span class="p">{</span>
    <span class="n">Id</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">(),</span>
    <span class="n">Name</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">(</span><span class="sc">'a'</span><span class="p">,</span> <span class="n">lengthGreaterThanAllowed</span><span class="p">)</span>
    <span class="n">Description</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">(</span><span class="sc">'b'</span><span class="p">,</span> <span class="n">lengthGreaterThanAllowed</span><span class="p">),</span>
<span class="p">};</span>
</pre></table></code></div></div><h3 id="crear-clases-de-ayuda-para-objetos-reutilizables">Crear clases de ayuda para objetos reutilizables</h3><p>El primer set de pruebas de una aplicación suele contener mucho código repetido. Yo considero que es normal y está bien. Cuando empezamos un proyecto completamente desde cero, nuestro objetivo debe ser asegurar que la funcionalidad principal esté respaldada por un set mínimo de pruebas. En esta etapa es muy probable que la lógica cambie con mucha frecuencia. <strong>Para que el set de pruebas pueda mantener el ritmo de cambio de la aplicación tenemos que ceder un poco en la claridad de su código para ganar más rapidez en su desarrollo.</strong></p><p>Sin embargo, conforme la aplicación se acerca a una versión estable, <strong>la primera refactorización que podemos aplicar al set de pruebas es centralizar todos los objetos y propiedades reutilizables en una clase de ayuda</strong>, dándoles un nombre suficientemente explícito para comunicar su función.</p><p>Podría mejorar:</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">AddItem_Success_ReturnsAddedItemId</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// arrange</span>
    <span class="c1">// La instancia de un objeto es creada dentro de la función de prueba</span>
        <span class="kt">var</span> <span class="n">newItem</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Item</span>
        <span class="p">{</span>
            <span class="n">Id</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">(),</span>
            <span class="n">Name</span> <span class="p">=</span> <span class="nf">GetUniqueValue</span><span class="p">(</span><span class="s">"Prefix"</span><span class="p">),</span>
            <span class="n">Description</span> <span class="p">=</span> <span class="s">"New item"</span>
        <span class="p">};</span>
    
    <span class="c1">// act</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_systemUnderTest</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="n">newItem</span><span class="p">);</span>

    <span class="c1">// assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">IsType</span><span class="p">&lt;</span><span class="n">Guid</span><span class="p">&gt;(</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Mejor:</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">AddItem_Success_ReturnsAddedItemId</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// arrange</span>
    <span class="c1">// La instancia de Item es creada en algún otro lugar. Aquí sólo mandamos llamar a la clase de ayuda que genera esa instancia por nosotros.</span>
    <span class="kt">var</span> <span class="n">newItem</span> <span class="p">=</span> <span class="n">TestUtils</span><span class="p">.</span><span class="nf">GetValidItemInstance</span><span class="p">();</span>
    
    <span class="c1">// act</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_systemUnderTest</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="n">newItem</span><span class="p">);</span>

    <span class="c1">// assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">IsType</span><span class="p">&lt;</span><span class="n">Guid</span><span class="p">&gt;(</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="principio-srp">Principio SRP</h2><p>Single Responsibility Principle. Principio de Única Responsabilidad.</p><h3 id="fábricas-de-dependencias">Fábricas de dependencias</h3><p>Las fábricas de dependencias son un gran ejemplo de la aplicación de SRP. Representan bloques de código que pueden acoplarse a múltiples sets de pruebas. Realizan una función específica y son mantenidos de forma independiente. Se vuelven necesarias cuando la aplicación está compuesta de múltiples capas de código.</p><p>Una API REST es un tipo de aplicación que puede estar formada por diferentes capas de código. Para construir un proyecto robusto como éste, eventualmente tendremos que escribir <strong>pruebas de integración</strong>. Ellas verifican que la interacción entre esas múltiples capas devuelva un resultado esperado.</p><p>Para crear las pruebas de integración de una API REST, nuestro set debe tener dos habilidades básicas:</p><ul><li>Realizar peticiones a través del protocolo HTTP.<li>Obtener la respuesta de cada petición, para poder manipular su contenido dentro de la prueba.</ul><p>La siguiente prueba aplica ambas habilidades en una forma simple:</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Add_Success_ReturnsCreatedCode</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// arrange</span>
    <span class="kt">var</span> <span class="n">itemRequest</span> <span class="p">=</span> <span class="n">TestUtils</span><span class="p">.</span><span class="nf">GetValidItemRequest</span><span class="p">();</span>

    <span class="c1">// act</span>
    <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="s">"api/items"</span><span class="p">,</span> <span class="n">itemRequest</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">stringContent</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;&lt;</span><span class="n">ItemResponse</span><span class="p">&gt;(</span><span class="n">stringContent</span><span class="p">);</span>

    <span class="c1">// assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Created</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="n">itemRequest</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>En el bloque anterior:</p><ul><li>El objeto <code class="language-plaintext highlighter-rouge">itemRequest</code> fue creado usando la clase de ayuda <code class="language-plaintext highlighter-rouge">TestUtils</code>.<li>Usa la función <code class="language-plaintext highlighter-rouge">PostAsync</code> para hacer la petición HTTP.<li>Convierte la respuesta obtenida en un objeto de tipo <code class="language-plaintext highlighter-rouge">string</code> para después hacer otra conversión al tipo concreto <code class="language-plaintext highlighter-rouge">ItemResponse</code>.</ul><p>Cuando el set de pruebas de integración para toda la aplicación es reducido (10 pruebas o menos), la implementación anterior puede ser suficientemente buena. Pero si esperamos que el volumen de pruebas crezca, podemos aplicar SRP desde las etapas tempranas para facilitarnos el desarrollo y mantenimiento en el futuro cercano.</p><p>En realidad, realizar peticiones por HTTP y obtener las respuestas no debe ser el fin, sino el medio de una prueba para obtener la información necesaria que nos ayude a comprobar si el resultado de una petición fue el esperado. Así que podemos pensar en delegar esas responsabilidades a alguien más. A una fábrica de dependencias, por ejemplo.</p><p>Creamos una fábrica que realiza peticiones HTTP y la llamamos <code class="language-plaintext highlighter-rouge">ApiClient</code>:</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Add_Success_ReturnsCreatedCode</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// arrange</span>
    <span class="kt">var</span> <span class="n">itemRequest</span> <span class="p">=</span> <span class="n">TestUtils</span><span class="p">.</span><span class="nf">GetValidItemRequest</span><span class="p">();</span>

    <span class="c1">// act</span>
    <span class="kt">var</span> <span class="n">created</span> <span class="p">=</span> <span class="k">await</span> <span class="n">ApiClient</span><span class="p">.</span><span class="n">MakeRequestAsync</span><span class="p">&lt;</span><span class="n">ItemResponse</span><span class="p">&gt;(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Post</span><span class="p">,</span> <span class="s">"api/items"</span><span class="p">,</span> <span class="n">itemRequest</span><span class="p">);</span>

    <span class="c1">// assert</span>
	<span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Created</span><span class="p">,</span> <span class="n">created</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="n">itemRequest</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">created</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>En el bloque anterior podemos notar varias mejoras:</p><ul><li>La petición HTTP se realiza a través de la función <code class="language-plaintext highlighter-rouge">MakeRequestAsync</code>.<li>En la misma llamada se especifica el valor de retorno esperado, un objeto de tipo <code class="language-plaintext highlighter-rouge">ItemResponse</code>.<li>La variable <code class="language-plaintext highlighter-rouge">created</code> contiene tanto el código de status HTTP como la información obtenida de la respuesta.</ul><p>La fábrica <code class="language-plaintext highlighter-rouge">ApliClient</code> le dio a esta prueba elegancia y simplicidad. Ahora el código es mucho más fácil de leer por nuestros colegas. Además, separar en una clase las responsabilidades para consumir nuestra API convierte a este set de pruebas en un proyecto fácilmente adaptable. Si en un futuro decidimos cambiar la implementación para realizar peticiones HTTP, haríamos el trabajo una sola vez, dentro de la función <code class="language-plaintext highlighter-rouge">MakeRequestAsync</code>, en lugar de cambiar cada una de las llamadas a <code class="language-plaintext highlighter-rouge">PostAsync</code> que estarían dispersas por todo el set de pruebas.</p><h2 id="las-pruebas-también-son-protagonistas">Las pruebas también son protagonistas</h2><p><strong>El primer cliente en la historia de nuestra aplicación es el primer set de pruebas que construimos para verificar su funcionamiento.</strong> Si mantenemos la cadencia de crear una prueba para cada nueva función, el set toma un rol principal: es el forjador que ayuda a determinar el diseño y a moldear la interface con la que interactúan entre sí múltiples partes de un sistema.</p><h2 id="simplificación-progresiva">Simplificación progresiva</h2><p>Al momento de leer esta guía, es probable que nuestro proyecto ya tenga un volumen considerable de pruebas. Algunas verifican el comportamiento de cada módulo aislando sus dependencias (unitarias), mientras otras verifican el comportamiento de toda la aplicación mientras completa una tarea (de integración). Considerando este escenario, puede sentirse abrumador siquiera considerar la idea de aplicar todas las guías mencionadas en este artículo.</p><p><strong>Cambia la perspectiva.</strong> En lugar de reestructurar el set de pruebas actual, piensa en que la próxima prueba que escribas puede ser el punto de partida para:</p><ul><li>Diseñar la arquitectura para almacenar clases de ayuda en un folder o proyecto dedicado.<li>Declarar en clases separadas las fábricas de dependencias que utilizará la nueva prueba.<li>Refactorizar las áreas de la aplicación que son verificadas por la prueba.</ul><p>Escribe código de pruebas tan legible como sea posible, pensando en nuestros futuros colegas o lectores del código.</p><h2 id="para-continuar-hablando-de-pruebas">Para continuar hablando de pruebas</h2><ul><li>Qué áreas/capas/lógica probar y cuándo no escribir pruebas.<li>Lenguaje apropiado en el mundo de las pruebas.<li>Cómo simular las dependencias de una implementación compleja.</ul><h2 id="referencias">Referencias</h2><ul><li><a href="https://docs.microsoft.com/en-us/dotnet/core/testing/unit-testing-best-practices">Unit testing best practices with .NET Core and .NET Standard</a><li><a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/testing?view=aspnetcore-3.1">Unit test controller logic in ASP.NET Core</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/testing/" class="post-tag no-text-decoration" >testing</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Fundamentos Para Construir Pruebas de Software Eficaces - Luis Guerrero&url=https://luisguerrerolab.com/posts/fundamentos-para-construir-pruebas-de-software-eficaces/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Fundamentos Para Construir Pruebas de Software Eficaces - Luis Guerrero&u=https://luisguerrerolab.com/posts/fundamentos-para-construir-pruebas-de-software-eficaces/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Fundamentos Para Construir Pruebas de Software Eficaces - Luis Guerrero&url=https://luisguerrerolab.com/posts/fundamentos-para-construir-pruebas-de-software-eficaces/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/aprender-con-learn-enough/">Mi Experiencia Aprendiendo Ruby Con Los Cursos de Learn Enough</a><li><a href="/posts/escribir-pruebas-mas-rapido/">Escribir código de pruebas más rápido usando snippets en Visual Studio Code</a><li><a href="/posts/entregar-mas-rapido-siendo-perfeccionista/">Cómo Entregar Resultados Más Rápido Siendo Perfeccionista</a><li><a href="/posts/edit-files-from-terminal-osx/">Search, replace and delete text from files using the terminal in OS X</a><li><a href="/posts/fundamentos-para-construir-pruebas-de-software-eficaces/">Fundamentos Para Construir Pruebas de Software Eficaces</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/english/">english</a> <a class="post-tag" href="/tags/learn/">learn</a> <a class="post-tag" href="/tags/personal-growth/">Personal growth</a> <a class="post-tag" href="/tags/project-management/">Project management</a> <a class="post-tag" href="/tags/testing/">testing</a> <a class="post-tag" href="/tags/vscode/">vscode</a> <a class="post-tag" href="/tags/xunit/">xunit</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/entregar-mas-rapido-siendo-perfeccionista/"><div class="card-body"> <span class="timeago small" > Nov 19, 2020 <i class="unloaded">2020-11-19T07:53:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cómo Entregar Resultados Más Rápido Siendo Perfeccionista</h3><div class="text-muted small"><p> Decidir que una actividad está lista para ser marcada como completa es una lucha constante que debemos atravesar las almas perfeccionistas a lo largo de cualquier proyecto. Encontramos más placer e...</p></div></div></a></div><div class="card"> <a href="/posts/escribir-pruebas-mas-rapido/"><div class="card-body"> <span class="timeago small" > Aug 16, 2020 <i class="unloaded">2020-08-16T15:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Escribir código de pruebas más rápido usando snippets en Visual Studio Code</h3><div class="text-muted small"><p> Hace poco escribí el set de pruebas unitarias para la primera versión de un proyecto Web API, usando el framework xUnit. Un endpoint podría presentar diferentes escenarios y quería escribir una pru...</p></div></div></a></div><div class="card"> <a href="/posts/aprender-con-learn-enough/"><div class="card-body"> <span class="timeago small" > Aug 11, 2020 <i class="unloaded">2020-08-11T18:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mi Experiencia Aprendiendo Ruby Con Los Cursos de Learn Enough</h3><div class="text-muted small"><p> El Descubrimiento A inicios abril decidí aprender a programar en Ruby de manera formal y comencé a buscar cursos que ofrecieran una guía completa, pero no exhaustiva, de todos los temas relevantes...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/aprender-con-learn-enough/" class="btn btn-outline-primary" prompt="Older"><p>Mi Experiencia Aprendiendo Ruby Con Los Cursos de Learn Enough</p></a> <a href="/posts/escribir-pruebas-mas-rapido/" class="btn btn-outline-primary" prompt="Newer"><p>Escribir código de pruebas más rápido usando snippets en Visual Studio Code</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/luisguerrerolab">Luis Guerrero</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/english/">english</a> <a class="post-tag" href="/tags/learn/">learn</a> <a class="post-tag" href="/tags/personal-growth/">Personal growth</a> <a class="post-tag" href="/tags/project-management/">Project management</a> <a class="post-tag" href="/tags/testing/">testing</a> <a class="post-tag" href="/tags/vscode/">vscode</a> <a class="post-tag" href="/tags/xunit/">xunit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://luisguerrerolab.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
